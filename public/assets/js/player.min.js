GAMEUSERS.namespace("GAMEUSERS.player"),$(function(){$("#bsTab #bs_tab_a").on("click",function(e){e.preventDefault(),$(this).tab("show")});var e=""===agent_type?"mouseenter":"touchstart";$("#bsTab li a").on(e,function(){var e=$(this).attr("href");"#tab_config"!==e||$("#tab_config").html()?"#tab_config_notification"!==e||$("#config_notification").html()?"#tab_config_advertisement"!==e||$("#tab_config_advertisement").html()?"#tab_help"!==e||$("#tab_help").html()||GAMEUSERS.common.readHelp(this,1,"player","player_about"):GAMEUSERS.player.readConfigAdvertisement():GAMEUSERS.player.readConfigNotification():GAMEUSERS.player.readConfig()}),$("#bsTab li a").on("shown.bs.tab",function(e){var a=$(this).attr("href");GAMEUSERS.common.openedContent=a.split("_")[1],""===agent_type?"help"===GAMEUSERS.common.openedContent&&GAMEUSERS.common.contentFixed.setUp():"help"===GAMEUSERS.common.openedContent&&GAMEUSERS.common.swiperHelp.update(!0),scrollToAnchor(a,-GAMEUSERS.common.headerBsTabMarginSize,0)});var a=$.cookie("read_type");"prof"==a&&($.removeCookie("read_type",{path:"/"}),setTimeout(function(){scrollToAnchor("#profile_box",-70,0)},500)),$("#tab_participation_community #participation_community_secret_box").hide()}),GAMEUSERS.player.readProfile=function(e,a,o){loadingToggle(e,null);var t=new FormData;t.append("page",a),t.append("user_no",o),$.ajax({url:uri_base+"rest/user/read_profile.json",dataType:"json",type:"POST",data:t,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){$("#profile_box").html(e.profile),$("#profile_pagination").html(e.pagination),scrollToAnchor("#profile_box",-GAMEUSERS.common.headerBsTabMarginSize,0),rewriteUrl()}).fail(function(){alert("error")}).always(function(){loadingToggle(e,null)})},GAMEUSERS.player.showEditProfileForm=function(e,a,o){var t;t=a?"#profile_box_user":o?"#profile_box_"+o:"#add_profile_form",a||o?loadingToggle(e,null):loadingToggle(null,"#submit_show_edit_profile_form_add");var n=new FormData;a&&n.append("user_no",a),o&&n.append("profile_no",o);var r=$("#form_fuel_csrf_token").val();n.append("fuel_csrf_token",r),$.ajax({url:uri_base+"rest/user/show_edit_profile_form.json",dataType:"json",type:"POST",data:n,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){a||o?($(t+" h2").hide(),$(t+" div").hide(),$(t).append(e.code)):$(t).html(e.code),o?profLocation="#profile_box_"+o:(profLocation="#add_profile_form",o=null);var n=new Bloodhound({limit:10,datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:uri_base+"rest/common/search_game_name.json?keyword=%QUERY"});n.initialize(),$(profLocation+" #game_name").typeahead(null,{name:"gameNameTypeahead",displayKey:"value",source:n.ttAdapter(),templates:{suggestion:function(e){return'<p class="needsclick">'+e.name+"</p>"}}}).bind("typeahead:selected",function(e,a){var t=$(profLocation+" #game_list").data("game-list");t||(t=[]),$.inArray(parseInt(a.game_no),t)==-1&&(t.push(a.game_no),$(profLocation+" #game_list").append('<div class="original_label_game bgc_lightseagreen cursor_pointer" id="game_no_'+a.game_no+'" onclick="deleteGameListNo(this, '+o+", "+a.game_no+')">'+a.name+"</div>"))})}).fail(function(){alert("error")}).always(function(){a||o?loadingToggle(e,null):loadingToggle(null,"#submit_show_edit_profile_form_add")})},GAMEUSERS.player.hideEditProfileForm=function(e,a,o){a?($("#profile_box_user h2").show(),$("#profile_box_user div").show(),$("#edit_profile_form_user_"+a).remove(),scrollToAnchor("#profile_box_user",-70,0)):o?($("#profile_box_"+o+" h2").show(),$("#profile_box_"+o+" div").show(),$("#edit_profile_form_profile_"+o).remove(),scrollToAnchor("#profile_box_"+o,-70,0)):$("#add_profile_form").html("")},GAMEUSERS.player.saveProfile=function(e,a,o){var t;t=a?"#profile_box_user":o?"#profile_box_"+o:"#add_profile_form",loadingToggle(e,null);var n=new FormData;a&&n.append("user_no",a),o&&n.append("profile_no",o),n.append("profile_title",$(t+" #profile_title").val()),n.append("handle_name",$(t+" #handle_name").val()),n.append("explanation",$(t+" #explanation").val()),n.append("status",$(t+" #status").val()),""!==$(t+" #thumbnail").val()&&n.append("thumbnail",$(t+" #thumbnail").prop("files")[0]),$(t+" #thumbnail_delete").prop("checked")&&n.append("thumbnail_delete",$(t+" #thumbnail_delete").prop("checked")),$(t+" #open_profile").prop("checked")||n.append("open_profile",1);var r=$(t+" #game_list").data("game-list");r&&n.append("game_list",r);var i=$("#form_fuel_csrf_token").val();n.append("fuel_csrf_token",i),$.ajax({url:uri_base+"rest/user/save_profile.json",dataType:"json",type:"POST",data:n,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){e.code&&(a||o?($(t).replaceWith(e.code),scrollToAnchor(t,-70,0)):location.href=uri_current)}).fail(function(){alert("error")}).always(function(a){a.alert_title&&showAlert(t+" #alert_edit_profile",a.alert_color,a.alert_title,a.alert_message),loadingToggle(e,null)})},GAMEUSERS.player.deleteProfile=function(e,a){if(window.confirm("プロフィールを削除しますか？")){var o="#profile_box_"+a;loadingToggle(e,null);var t=new FormData;t.append("profile_no",a);var n=$("#form_fuel_csrf_token").val();t.append("fuel_csrf_token",n),$.ajax({url:uri_base+"rest/user/delete_profile.json",dataType:"json",type:"POST",data:t,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(){$(o).replaceWith("")}).fail(function(){alert("error")}).always(function(a){a.alert_title&&showAlert(o+" #alert_edit_profile",a.alert_color,a.alert_title,a.alert_message),loadingToggle(e,null)})}},GAMEUSERS.player.deleteGameListNo=function(e,a,o){var t;t=a?"#profile_box_"+a:"#add_profile_form";var n=$(t+" #game_list").data("game-list");$.each(n,function(e,a){a==o&&n.splice(e,1)}),$(t+" #game_list #game_no_"+o).remove()},GAMEUSERS.player.readParticipationCommunity=function(e,a,o){var t,n="#tab_participation_community",r=$(e).attr("id");"read_participation_community_open"==r?(t="open",$(n).data("type",t)):"read_participation_community_close"==r?(t="close",$(n).data("type",t)):t=$(n).data("type"),$(n+" #read_participation_button")[0]&&("open"==t?($(n+" #read_participation_community_open").attr("class","btn btn-default ladda-button active"),$(n+" #read_participation_community_close").attr("class","btn btn-default ladda-button"),$(n+" #participation_community_box").show(),$(n+" #participation_community_secret_box").hide()):($(n+" #read_participation_community_open").attr("class","btn btn-default ladda-button"),$(n+" #read_participation_community_close").attr("class","btn btn-default ladda-button active"),$(n+" #participation_community_box").hide(),$(n+" #participation_community_secret_box").show())),loadingToggle(e,null);var i=new FormData;i.append("page",a),i.append("user_no",o),i.append("type",t),$.ajax({url:uri_base+"rest/user/read_participation_community.json",dataType:"json",type:"POST",data:i,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){e.code&&("open"==t?$(n+" #participation_community_box").html(e.code):$(n+" #participation_community_secret_box").html(e.code))}).fail(function(){alert("error")}).always(function(){loadingToggle(e,null)})},GAMEUSERS.player.saveConfigPage=function(e){var a="#config_page";loadingToggle(e,null);var o=new FormData;""!==$(a+" #top_image_1").val()&&o.append("top_image_1",$(a+" #top_image_1").prop("files")[0]),""!==$(a+" #top_image_2").val()&&o.append("top_image_2",$(a+" #top_image_2").prop("files")[0]),""!==$(a+" #top_image_3").val()&&o.append("top_image_3",$(a+" #top_image_3").prop("files")[0]),$(a+" #top_image_1_delete").prop("checked")&&o.append("top_image_1_delete",1),$(a+" #top_image_2_delete").prop("checked")&&o.append("top_image_2_delete",1),$(a+" #top_image_3_delete").prop("checked")&&o.append("top_image_3_delete",1),o.append("page_title",$(a+" #page_title").val()),o.append("user_id",$(a+" #user_id").val());var t=$("#form_fuel_csrf_token").val();o.append("fuel_csrf_token",t),$.ajax({url:uri_base+"rest/user/save_config_page.json",dataType:"json",type:"POST",data:o,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){"success"==e.alert_color&&(location.href=uri_base+"pl/"+$(a+" #user_id").val())}).fail(function(){alert("error")}).always(function(o){o.alert_title&&showAlert(a+" #alert_config_page",o.alert_color,o.alert_title,o.alert_message),loadingToggle(e,null)})},GAMEUSERS.player.saveConfigNotification=function(e){var a=$(e).closest("#config_notification");loadingToggle(e,null);var o=new FormData,t=$(a).find("input[name='config_notification_on_off']:checked").val();t&&o.append("on_off",t);var n;$(a).find("#config_notification_on_off_browser")[0]&&(n=$(a).find("#config_notification_on_off_browser").prop("checked")?"on":"off",o.append("on_off_browser",n));var r;$(a).find("#config_notification_on_off_app")[0]&&(r=$(a).find("#config_notification_on_off_app").prop("checked")?"on":"off",o.append("on_off_app",r));var i;$(a).find("#config_notification_on_off_mail")[0]&&(i=$(a).find("#config_notification_on_off_mail").prop("checked")?"on":"off",o.append("on_off_mail",i));var l=[];if($(a).find("[id=config_notification_receive_browser]").each(function(e,a){$(a).is(":checked")&&l.push($(a).val())}),l.length>3)return showAlert($(a).find("#alert"),"warning","エラー","選択できるのは3つまでです。"),void loadingToggle(e,null);l.length>0&&o.append("receive_browser",l);var p=[];$(a).find("[id=config_notification_browser_delete]").each(function(e,a){$(a).is(":checked")&&p.push($(a).val())}),p.length>0&&o.append("delete_browser",p);var _=$(a).find("input[name='config_notification_receive_device']:checked").val();_&&o.append("receive_device",_);var c=[];$(a).find("[id=config_notification_app_device_delete]").each(function(e,a){$(a).is(":checked")&&c.push($(a).val())}),c.length>0&&o.append("delete_device",c);var d=$("#form_fuel_csrf_token").val();o.append("fuel_csrf_token",d),$.ajax({url:uri_base+"rest/user/save_notification_data.json",dataType:"json",type:"POST",data:o,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(){p.length>0&&$.each(p,function(e,a){$("#tr_"+a).fadeOut("slow")}),c.length>0&&$.each(c,function(e,a){$("#tr_"+a).fadeOut("slow")})}).fail(function(){alert("error")}).always(function(o){o.alert_title&&showAlert($(a).find("#alert"),o.alert_color,o.alert_title,o.alert_message),loadingToggle(e,null)})},GAMEUSERS.player.saveEmail=function(e){var a="#config_notification";loadingToggle(e,null);var o,t=new FormData,n=$(a+" #email").val();if(n)o="save";else if(o="delete",!window.confirm("Eメールを削除してもよろしいですか？"))return void loadingToggle(e,null);t.append("email",n);var r=$("#form_fuel_csrf_token").val();t.append("fuel_csrf_token",r),$.ajax({url:uri_base+"rest/user/"+o+"_email.json",dataType:"json",type:"POST",data:t,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(){}).fail(function(){alert("error")}).always(function(o){o.alert_title&&showAlert(a+" #alert_email",o.alert_color,o.alert_title,o.alert_message),loadingToggle(e,null)})},GAMEUSERS.player.saveLoginUsername=function(e){var a="#config_account";loadingToggle(e,null);var o=new FormData;o.append("login_username",$(a+" #login_username").val());var t=$("#form_fuel_csrf_token").val();o.append("fuel_csrf_token",t),$.ajax({url:uri_base+"rest/user/save_login_username.json",dataType:"json",type:"POST",data:o,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(){}).fail(function(){alert("error")}).always(function(o){o.alert_title&&showAlert(a+" #alert_login_username",o.alert_color,o.alert_title,o.alert_message),loadingToggle(e,null)})},GAMEUSERS.player.saveLoginPassword=function(e){var a="#config_account",o=$(a+" #login_password").val(),t=$(a+" #login_password_verification").val();if(o!=t)return void showAlert(a+" #alert_login_password","warning","エラー","パスワードが再入力したパスワードと違っています。");loadingToggle(e,null);var n=new FormData;n.append("login_password",o);var r=$("#form_fuel_csrf_token").val();n.append("fuel_csrf_token",r),$.ajax({url:uri_base+"rest/user/save_login_password.json",dataType:"json",type:"POST",data:n,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(){}).fail(function(){alert("error")}).always(function(o){o.alert_title&&showAlert(a+" #alert_login_password",o.alert_color,o.alert_title,o.alert_message),loadingToggle(e,null)})},GAMEUSERS.player.deletePlayerAccount=function(e){var a="#config_delete_player_account",o=$(a+" #delete_player_account_verification").val();if("delete"!=o)return void showAlert(a+" #alert","warning","エラー","確認キーワードが違っています。");if(window.confirm("アカウントを削除してもよろしいですか？")){loadingToggle(e,null);var t=new FormData,n=$("#form_fuel_csrf_token").val();t.append("fuel_csrf_token",n),$.ajax({url:uri_base+"rest/user/delete_player_account.json",dataType:"json",type:"POST",data:t,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){"success"==e.alert_color&&(location.href=uri_base)}).fail(function(){alert("error")}).always(function(o){o.alert_title&&showAlert(a+" #alert",o.alert_color,o.alert_title,o.alert_message),loadingToggle(e,null)})}},GAMEUSERS.player.readFormAdvertisement=function(e,a){var o=$(e).closest("#config_advertisement_form_box");loadingToggle(e,null);var t=new FormData;t.append("page",a);var n=$("#form_fuel_csrf_token").val();t.append("fuel_csrf_token",n),$.ajax({url:uri_base+"/rest/user/read_form_advertisement.json",dataType:"json",type:"POST",data:t,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){e.code&&$(o).html(e.code)}).fail(function(){alert("error")}).always(function(a){a.alert_title&&showAlert($(o).find("#alert"),a.alert_color,a.alert_title,a.alert_message),loadingToggle(e,null)})},GAMEUSERS.player.saveAmazonTrackingId=function(e){var a=$(e).closest("#config_advertisement_amazon");loadingToggle(e,null);var o=new FormData;o.append("tracking_id",$(a).find("#tracking_id").val());var t=$("#form_fuel_csrf_token").val();o.append("fuel_csrf_token",t),$.ajax({url:uri_base+"/rest/user/save_amazon_tracking_id.json",dataType:"json",type:"POST",data:o,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(){}).fail(function(){alert("error")}).always(function(o){o.alert_title&&showAlert($(a).find("#alert"),o.alert_color,o.alert_title,o.alert_message),loadingToggle(e,null)})},GAMEUSERS.player.saveAdvertisement=function(e){var a=$(e).closest("#ad_box");loadingToggle(e,null);var o=new FormData,t=$(a).data("advertisement_no");t&&o.append("advertisement_no",t),o.append("name",$(a).find("#name").val()),o.append("code",$(a).find("#code").val()),o.append("code_sp",$(a).find("#code_sp").val()),o.append("comment",$(a).find("#comment").val()),$(a).find("#hide_myself").prop("checked")&&o.append("hide_myself",$(a).find("#hide_myself").prop("checked"));var n=$(a).find("#approval option:selected").val();n&&o.append("approval",n);var r=$("#form_fuel_csrf_token").val();o.append("fuel_csrf_token",r),$.ajax({url:uri_base+"/rest/user/save_advertisement.json",dataType:"json",type:"POST",data:o,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){e.label_approval_code&&$(a).find("#label_approval").html(e.label_approval_code)}).fail(function(){alert("error")}).always(function(o){o.alert_title&&showAlert($(a).find("#alert"),o.alert_color,o.alert_title,o.alert_message),loadingToggle(e,null)})},GAMEUSERS.player.showAdvertisement=function(e){var a=$(e).closest("#ad_box"),o=$(a).data("showing");if(o)return $(a).find("#test_box").hide(),$(a).find("#test_box_sp").hide(),void $(a).data("showing",!1);var t=$(a).find("#code").val(),n=$(a).find("#code_sp").val();t&&$(a).find("#test_box").addClass("padding_bottom_20").html(t).show(),n&&$(a).find("#test_box_sp").addClass("padding_bottom_20").html(n).show(),$(a).data("showing",!0)},GAMEUSERS.player.readConfig=function(){var e="#tab_config",a=new FormData;a.append("api_type","config_player_basic");var o=$("#form_fuel_csrf_token").val();a.append("fuel_csrf_token",o),$.ajax({url:uri_base+"rest/api/common.json",dataType:"json",type:"POST",data:a,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(a){a.code&&$(e).html(a.code)}).fail(function(){alert("error")}).always(function(){})},GAMEUSERS.player.readConfigNotification=function(){var e="#tab_config_notification",a=new FormData;a.append("api_type","config_notification");var o=$("#form_fuel_csrf_token").val();a.append("fuel_csrf_token",o),$.ajax({url:uri_base+"rest/api/common.json",dataType:"json",type:"POST",data:a,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(a){a.code&&$(e).html(a.code)}).fail(function(){alert("error")}).always(function(){})},GAMEUSERS.player.readConfigAdvertisement=function(){var e="#tab_config_advertisement",a=new FormData;a.append("api_type","config_advertisement");var o=$("#form_fuel_csrf_token").val();a.append("fuel_csrf_token",o),$.ajax({url:uri_base+"rest/api/common.json",dataType:"json",type:"POST",data:a,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(a){a.code&&$(e).html(a.code)}).fail(function(){alert("error")}).always(function(){})};
GAMEUSERS.namespace("GAMEUSERS.wiki_config"),$(function(){$("#tab_wiki")[0]}),GAMEUSERS.wiki_config.readWikiList=function(e,a,i){var t;t=i?$("#change_contents_wiki_edit"):$("#change_contents_wiki_list"),loadingToggle(e,null);var n=new FormData;n.append("page",a),i&&n.append("edit",1);var o=$("#form_fuel_csrf_token").val();n.append("fuel_csrf_token",o),$.ajax({url:uri_base+"rest/wiki/read_wiki_list.json",dataType:"json",type:"POST",data:n,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){e.code?($(t).html(e.code),scrollToAnchor("#tab_wiki",-GAMEUSERS.common.headerBsTabMarginSize,0),i&&GAMEUSERS.common.searchGameListNo(t.find("#scrollable-dropdown-menu .typeahead"))):i&&$("#button_change_contents_wiki_edit").hide()}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(a){a.alert_title&&showAlert($(t).find("#alert"),a.alert_color,a.alert_title,a.alert_message),loadingToggle(e,null)})},GAMEUSERS.wiki_config.readWikiListEdit=function(e,a){var i=$("#content_wiki_edit");loadingToggle(e,null);var t=new FormData;t.append("api_type","content_wiki_edit"),t.append("page",a);var n=$("#form_fuel_csrf_token").val();t.append("fuel_csrf_token",n),$.ajax({url:uri_base+"rest/api/common.json",dataType:"json",type:"POST",data:t,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){e.code&&($(i).html(e.code),scrollToAnchor(i,-GAMEUSERS.common.headerBsTabMarginSize,0),GAMEUSERS.common.searchGameListNo(i.find("#scrollable-dropdown-menu .typeahead")))}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(a){a.alert_title&&showAlert($(i).find("#alert"),a.alert_color,a.alert_title,a.alert_message),loadingToggle(e,null)})},GAMEUSERS.wiki_config.readWikiCreate=function(){var e=$("#change_contents_wiki_create"),a=new FormData,i=$("#form_fuel_csrf_token").val();a.append("fuel_csrf_token",i),$.ajax({url:uri_base+"rest/wiki/read_wiki_create.json",dataType:"json",type:"POST",data:a,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(a){a.code&&($(e).html(a.code),GAMEUSERS.common.searchGameListNo(e.find("#scrollable-dropdown-menu .typeahead")))}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(e){})},GAMEUSERS.wiki_config.saveWiki=function(e){var a=$(e).closest("#wiki_edit_box"),i=$(a).find("#wiki_password").val(),t=$(a).find("#wiki_password_confirm").val();if(i!==t)return void showAlert($(a).find("#alert"),"warning","エラー","パスワードが再入力したパスワードと違っています。");if($(a).find("#user_terms_approval")[0]&&!$(a).find("#user_terms_approval").prop("checked"))return void showAlert($(a).find("#alert"),"warning","エラー","Wiki使用ルールに同意する必要があります。");loadingToggle(e,null);var n=new FormData,o=$(a).data("wiki_no");o&&n.append("wiki_no",o),n.append("wiki_id",$(a).find("#wiki_id").val()),n.append("wiki_name",$(a).find("#wiki_name").val()),n.append("wiki_comment",$(a).find("#wiki_comment").val()),n.append("wiki_password",$(a).find("#wiki_password").val()),n.append("game_list",$(a).find("#game_list").data("game-list"));var r=$("#form_fuel_csrf_token").val();n.append("fuel_csrf_token",r),$.ajax({url:uri_base+"rest/wiki/save_wiki.json",dataType:"json",type:"POST",data:n,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){"success"===e.alert_color&&(o||window.location.reload())}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(i){i.alert_title&&showAlert($(a).find("#alert"),i.alert_color,i.alert_title,i.alert_message),loadingToggle(e,null)})},GAMEUSERS.wiki_config.saveWikiAdvertisement=function(e){var a=$(e).closest("#wiki_edit_advertisement_box");loadingToggle(e,null);var i=new FormData,t=$(a).data("wiki_no");t&&i.append("wiki_no",t),i.append("wiki_1",$(a).find("#wiki_1").val()),i.append("wiki_2",$(a).find("#wiki_2").val()),$(a).find("#amazon_slide").prop("checked")&&i.append("amazon_slide",$(a).find("#amazon_slide").prop("checked"));var n=$("#form_fuel_csrf_token").val();i.append("fuel_csrf_token",n),$.ajax({url:uri_base+"rest/wiki/save_wiki_advertisement.json",dataType:"json",type:"POST",data:i,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(){}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(i){i.alert_title&&showAlert($(a).find("#alert"),i.alert_color,i.alert_title,i.alert_message),loadingToggle(e,null)})},GAMEUSERS.wiki_config.deleteWiki=function(e){var a=$(e).closest("#wiki_edit_box"),i=window.prompt("Wikiを削除する場合は delete と入力してください。","");if("delete"!=i)return void showAlert($(a).find("#alert"),"warning","エラー","確認キーワードが違っています。");if(window.confirm("本当に削除してもよろしいですか？一度、削除すると元には戻せません。")){loadingToggle(e,null);var t=new FormData,n=$(a).data("wiki_no");t.append("wiki_no",n),"undefined"!=typeof appMode&&t.append("app_mode",!0);var o=$("#form_fuel_csrf_token").val();t.append("fuel_csrf_token",o),$.ajax({url:uri_base+"rest/wiki/delete_wiki.json",dataType:"json",type:"POST",data:t,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){"success"==e.alert_color&&window.location.reload()}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(i){i.alert_title&&showAlert($(a).find("#alert"),i.alert_color,i.alert_title,i.alert_message),loadingToggle(e,null)})}};
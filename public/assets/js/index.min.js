GAMEUSERS.namespace("GAMEUSERS.index"),$(function(){GAMEUSERS.common.thumbnailAdHideShow(),$(window).on("resize",function(){GAMEUSERS.common.thumbnailAdHideShow()}),$("#slideMenu")[0]&&($("#slideMenu").css("display","block"),$("#slideMenu").lastSidebar({align:"left"})),$("#menu_feed, #content_feed_index").not(".card_thumbnail").imagesLoaded(function(){if("smartphone"!==agent_type&&(GAMEUSERS.common.masonryFeed=$("#feed_card_box").masonry({itemSelector:"#feed_card",columnWidth:157})),"smartphone"!==agent_type){AOS.init();var e=!0;$(window).on("resize",function(){e&&(AOS.init({disable:!0}),e=!1)})}""===agent_type?GAMEUSERS.common.stickyMenu(".menu .slide","rectangle"):GAMEUSERS.common.stickyMenu(".menu_s .slide","small"),$(window).trigger("scroll")}),$("[id=menu_card]").on("click",function(e){var t=$(this).data("group"),a=$(this).data("content");if("feed"===t&&"index"===a){var n=$(this).data("feed"),o=$(this).data("page");GAMEUSERS.common.readFeed(this,o,n,0,1,1),GAMEUSERS.common.changeMenuContents(this,t,a)}else{if("wiki"===t&&"edit"===a&&!$("#content_wiki_edit").html()){PNotify.prototype.options.delay=3e3;var r="注意",i="編集できるWikiがありません。";return void new PNotify({styling:"bootstrap3",title:r,text:i})}GAMEUSERS.common.changeMenuContents(this,t,a),GAMEUSERS.common.changeUrlAndMeta(t,a)}""===agent_type?($("[id=menu_card][data-group="+t+"]").find(".selected_icon").addClass("element_hidden"),$(this).find(".selected_icon").removeClass("element_hidden")):($("[id=menu_card][data-group="+t+"] span").removeClass("selected"),$(this).find("span").addClass("selected")),GAMEUSERS.common.closeSlideMenu()});var e=""===agent_type?"mouseenter":"touchstart";$("[data-look-ahead=true]").on(e,function(e){var t=$(this).data("group"),a=$(this).data("content");GAMEUSERS.index.readLookAhead(t,a)});var t=!0;$("#tab_help").on(e,function(){"help"!==contents_data.initial_load.group&&t&&(GAMEUSERS.common.readHelpVer2(this,1,"top","top_about"),t=!1)}),"feed"===contents_data.initial_load.group&&"index"===contents_data.initial_load.content||GAMEUSERS.common.readFeed(this,1,"all",0,0,0),"community"===contents_data.initial_load.group&&"index"===contents_data.initial_load.content||GAMEUSERS.common.readCommunityList(this,1,"all",null,0,0,0),"wiki"===contents_data.initial_load.group&&"index"===contents_data.initial_load.content||GAMEUSERS.common.readWikiList(this,1,0,0,0),""!==agent_type&&($(".card_s .top .right .title h2").trunk8({lines:2}),$(window).resize(function(e){$(".card_s .top .right .title h2").trunk8({lines:2})})),window.history&&window.history.pushState&&$(window).on("popstate",function(e){if(e.originalEvent.state){var t=e.originalEvent.state;GAMEUSERS.common.changeMenuContents(this,t.group,t.content),console.log(t.group,t.content,t.function),"readFeed"===t.function?GAMEUSERS.common.readFeed(this,t.page,t.type,0,1,0):"readCommunityList"===t.function?GAMEUSERS.common.readCommunityList(this,t.page,t.type,null,0,1,0):"readWikiList"===t.function&&GAMEUSERS.common.readWikiList(this,t.page,0,1,0)}}),$.contextMenu({selector:"#jslink",callback:function(e,t){var a="_target",n=$(this).data("jslink");window.open(n,a)},items:{new:{name:"新しいタブで開く"}}}),"feed"===contents_data.initial_load.group&&"register_game"!==contents_data.initial_load.content&&GAMEUSERS.index.searchDeveloperAutoComplete(),$(document).on("keypress","#form_register_game #keyword",function(e){if(13==e.which)return GAMEUSERS.index.searchGameData(this,1),!1}),$(document).on("keypress","#form_register_developer #keyword",function(e){if(13==e.which)return GAMEUSERS.index.searchDeveloperForm(this,1),!1}),$(document).on("keypress","#form_register_genre #keyword",function(e){if(13==e.which)return GAMEUSERS.index.searchGenreForm(this,1),!1})}),GAMEUSERS.index.readLookAheadArr=[],GAMEUSERS.index.readLookAhead=function(e,t){var a=e+"_"+t;if(GAMEUSERS.index.readLookAheadArr.indexOf(a)===-1){var n="#content_"+a,o=new FormData;o.append("api_type","content_"+a),"wiki_edit"===a&&o.append("page",1);var r=$("#form_fuel_csrf_token").val();o.append("fuel_csrf_token",r),$.ajax({url:uri_base+"rest/api/common.json",dataType:"json",type:"POST",data:o,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(o){o.code&&($(n).html(o.code),"community_create"===a?(GAMEUSERS.common.searchGameListNo("#config_community_basis .typeahead"),contents_data.community_create.state=o.state,contents_data.community_create.url=o.url,contents_data.community_create.meta_title=o.meta_title,contents_data.community_create.meta_keywords=o.meta_keywords,contents_data.community_create.meta_description=o.meta_description):"wiki_create"===a?(contents_data.wiki_create.state=o.state,contents_data.wiki_create.url=o.url,contents_data.wiki_create.meta_title=o.meta_title,contents_data.wiki_create.meta_keywords=o.meta_keywords,contents_data.wiki_create.meta_description=o.meta_description):"wiki_edit"===a?(GAMEUSERS.common.searchGameListNo("#wiki_edit_box .typeahead"),contents_data.wiki_edit.state=o.state,contents_data.wiki_edit.url=o.url,contents_data.wiki_edit.meta_title=o.meta_title,contents_data.wiki_edit.meta_keywords=o.meta_keywords,contents_data.wiki_edit.meta_description=o.meta_description):"feed_register_game"===a&&(GAMEUSERS.index.searchDeveloperAutoComplete(),contents_data.feed_register_game.state=o.state,contents_data.feed_register_game.url=o.url,contents_data.feed_register_game.meta_title=o.meta_title,contents_data.feed_register_game.meta_keywords=o.meta_keywords,contents_data.feed_register_game.meta_description=o.meta_description),""!==agent_type&&GAMEUSERS.common.changeUrlAndMeta(e,t))}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(){GAMEUSERS.index.readLookAheadArr.indexOf(a)===-1&&GAMEUSERS.index.readLookAheadArr.push(a)})}},GAMEUSERS.index.createCommunity=function(e){var t="#config_community_basis";loadingToggle(e,null);var a=new FormData;a.append("community_name",$(t+" #community_name").val()),a.append("community_description",$(t+" #community_description").val()),a.append("community_description_mini",$(t+" #community_description_mini").val()),a.append("community_id",$(t+" #community_id").val()),a.append("game_list",$(t+" #game_list").data("game-list"));var n=$("#form_fuel_csrf_token").val();a.append("fuel_csrf_token",n),$.ajax({url:uri_base+"rest/index/create_user_community.json",dataType:"json",type:"POST",data:a,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){"success"==e.alert_color&&(location.href=uri_base+"uc/"+$(t+" #community_id").val())}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(a){a.alert_title&&showAlert(t+" #alert",a.alert_color,a.alert_title,a.alert_message),loadingToggle(e,null)})},GAMEUSERS.index.searchGameData=function(e,t){var a="#form_register_game",n=$(e).attr("id");"keyword"==n?loadingToggle(null,a+" #search_game_data"):loadingToggle(e,null);var o=new FormData;o.append("api_type","register_game"),o.append("page",t),o.append("keyword",$(a+" #keyword").val());var r=$("#form_fuel_csrf_token").val();o.append("fuel_csrf_token",r),$.ajax({url:uri_base+"rest/api/common.json",dataType:"json",type:"POST",data:o,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){e.code?$(a+" #game_data_box").html(e.code):$(a+" #game_data_box").html(""),scrollToAnchor(a+" #search_game",-70,0)}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(t){t.alert_title&&showAlert(a+" #alert",t.alert_color,t.alert_title,t.alert_message),"keyword"==n?loadingToggle(null,a+" #search_game_data"):loadingToggle(e,null)})},GAMEUSERS.index.readGameData=function(e,t,a){var n="[id=content_feed_register_game] #game_no_"+t;loadingToggle(e,null);var o=new FormData;o.append("api_type","register_game"),o.append("page",1),o.append("game_no",t),null!==a&&o.append("history_no",a);var r=$("#form_fuel_csrf_token").val();o.append("fuel_csrf_token",r),$.ajax({url:uri_base+"rest/api/common.json",dataType:"json",type:"POST",data:o,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){e.code&&$(n).replaceWith(e.code)}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(t){t.alert_title&&showAlert(n+" #alert",t.alert_color,t.alert_title,t.alert_message),loadingToggle(e,null)})},GAMEUSERS.index.saveGameData=function(e,t){var a=null;a=t?"#content_feed_register_game #game_no_"+t:"#content_feed_register_game #game_no_new",loadingToggle(e,null);var n=new FormData;if(t&&n.append("game_no",t),n.append("name",$(a+" #name").val()),n.append("subtitle",$(a+" #subtitle").val()),$(a+" #id")[0]){var o;for(o=0;o<20;o++)$(a+" #similarity_"+o).val()&&n.append("similarity_"+o,$(a+" #similarity_"+o).val());if(n.append("id",$(a+" #id").val()),n.append("kana",$(a+" #kana").val()),n.append("twitter_hashtag_ja",$(a+" #twitter_hashtag_ja").val()),""!==$(a+" #thumbnail").val()&&n.append("thumbnail",$(a+" #thumbnail").prop("files")[0]),$(a+" #thumbnail_delete").prop("checked")&&n.append("thumbnail_delete",$(a+" #thumbnail_delete").prop("checked")),t){for(o=1;o<=5;o++)$(a+" #hardware_"+o).val()&&n.append("hardware_"+o,$(a+" #hardware_"+o).val()),$(a+" #release_date_"+o).val()&&n.append("release_date_"+o,$(a+" #release_date_"+o).val()),$(a+" #genre_"+o).val()&&n.append("genre_"+o,$(a+" #genre_"+o).val());if(0!==$(a+" #players_max").val()&&n.append("players_max",$(a+" #players_max").val()),n.append("developer",$(a+" #developer_list").data("list")),$(a+" .upload [id^=image_]")[0]&&$.each($(a+" .upload [id^=image_]"),function(e,t){n.append($(this).attr("id"),$(this).prop("files")[0])}),$(a+" .delete [id^=image_]")[0]){var r=[];$.each($(a+" .delete [id^=image_delete_]"),function(e,t){$(this).prop("checked")&&r.push($(this).data("id"))});var i=r.join(",");i&&n.append("delete_image_ids",i)}for(o=1;o<=20;o++)$(a+" #type_"+o).val()&&(n.append("link_type_"+o,$(a+" #type_"+o).val()),n.append("link_country_"+o,$(a+" #country_"+o).val()),n.append("link_name_"+o,$(a+" #name_"+o).val()),n.append("link_url_"+o,$(a+" #url_"+o).val()))}$(a+" #first_bbs_thread").prop("checked")&&n.append("first_bbs_thread",$(a+" #first_bbs_thread").prop("checked"))}var l=$("#form_fuel_csrf_token").val();n.append("fuel_csrf_token",l),$.ajax({url:uri_base+"rest/index/save_game_data.json",dataType:"json",type:"POST",data:n,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){e.code&&($(a).replaceWith(e.code),t&&scrollToAnchor("#game_no_"+t,-(GAMEUSERS.common.headerHeightVer2+GAMEUSERS.common.tabHeightVer2),0),$(a+" #id")[0]&&GAMEUSERS.index.searchDeveloperAutoComplete(),t||new PNotify({styling:"bootstrap3",title:"ゲーム登録",text:"完了しました。",type:"success"}))}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(t){t.alert_title&&showAlert(a+" #alert",t.alert_color,t.alert_title,t.alert_message),loadingToggle(e,null)})},GAMEUSERS.index.searchDeveloperAutoComplete=function(){var e=$("#game_data_box #scrollable-dropdown-menu .typeahead"),t=new Bloodhound({limit:10,datumTokenizer:Bloodhound.tokenizers.obj.whitespace("value"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:uri_base+"rest/index/search_developer.json?keyword=%QUERY"});t.initialize(),e.typeahead(null,{name:"developerTypeahead",displayKey:"value",source:t.ttAdapter(),templates:{suggestion:function(e){return'<p class="needsclick">'+e.name+" / "+e.studio+"</p>"}}}).bind("typeahead:selected",function(e,t){var a=$(this).closest("#scrollable-dropdown-menu").find("#developer_list"),n=a.data("list");n||(n=[]),$.inArray(parseInt(t.developer_no),n)==-1&&(n.push(t.developer_no),$(a).append('<div class="original_label_game bgc_lightseagreen cursor_pointer" id="developer_no_'+t.developer_no+'" onclick="GAMEUSERS.index.deleteDeveloperAutoComplete(this, '+t.developer_no+')">'+t.name+" / "+t.studio+"</div>"),a.data("list",n))})},GAMEUSERS.index.deleteDeveloperAutoComplete=function(e,t){var a=$(e).closest("#developer_list"),n=$(a).data("list");$.each(n,function(e,a){a==t&&n.splice(e,1)});var o=$(e).closest("#scrollable-dropdown-menu").find("#developer_list");o.data("list",n),$(a).find("#developer_no_"+t).remove()},GAMEUSERS.index.searchDeveloperForm=function(e,t){var a=$("#form_register_developer");loadingToggle(e,null);var n=new FormData;n.append("api_type","form_developer"),n.append("keyword",$(a).find("#keyword").val()),n.append("page",t);var o=$("#form_fuel_csrf_token").val();n.append("fuel_csrf_token",o),$.ajax({url:uri_base+"rest/api/common.json",dataType:"json",type:"POST",data:n,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){e.code&&($(a).replaceWith(e.code),scrollToAnchor("#form_register_developer",-(GAMEUSERS.common.headerHeightVer2+GAMEUSERS.common.tabHeightVer2),0))}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(t){t.alert_title&&showAlert($(a).find("#alert"),t.alert_color,t.alert_title,t.alert_message),loadingToggle(e,null)})},GAMEUSERS.index.saveDeveloper=function(e,t){var a=$(e).closest("#register_developer");loadingToggle(e,null);var n=new FormData;n.append("api_type","save_developer"),t&&n.append("developer_no",t),n.append("name",$(a).find("#name").val()),n.append("abbreviation",$(a).find("#abbreviation").val()),n.append("studio",$(a).find("#studio").val()),n.append("abbreviation",$(a).find("#abbreviation").val());var o=$("#form_fuel_csrf_token").val();n.append("fuel_csrf_token",o),$.ajax({url:uri_base+"rest/api/common.json",dataType:"json",type:"POST",data:n,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(t){t.alert_title&&showAlert($(a).find("#alert"),t.alert_color,t.alert_title,t.alert_message),loadingToggle(e,null)})},GAMEUSERS.index.searchGenreForm=function(e,t){var a=$("#form_register_genre");loadingToggle(e,null);var n=new FormData;n.append("api_type","form_genre"),n.append("keyword",$(a).find("#keyword").val()),n.append("page",t);var o=$("#form_fuel_csrf_token").val();n.append("fuel_csrf_token",o),$.ajax({url:uri_base+"rest/api/common.json",dataType:"json",type:"POST",data:n,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){e.code&&($(a).replaceWith(e.code),scrollToAnchor("#form_register_genre",-(GAMEUSERS.common.headerHeightVer2+GAMEUSERS.common.tabHeightVer2),0))}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(t){t.alert_title&&showAlert($(a).find("#alert"),t.alert_color,t.alert_title,t.alert_message),loadingToggle(e,null)})},GAMEUSERS.index.saveGenre=function(e,t){var a=$(e).closest("#register_genre");loadingToggle(e,null);var n=new FormData;n.append("api_type","save_genre"),t&&n.append("genre_no",t),n.append("sort",$(a).find("#sort").val()),n.append("name",$(a).find("#name").val());var o=$("#form_fuel_csrf_token").val();n.append("fuel_csrf_token",o),$.ajax({url:uri_base+"rest/api/common.json",dataType:"json",type:"POST",data:n,enctype:"multipart/form-data",processData:!1,contentType:!1}).done(function(e){}).fail(function(){uri_base.indexOf("https://gameusers.org/")===-1&&alert("error")}).always(function(t){t.alert_title&&showAlert($(e).closest("#form_register_genre").find("#alert"),t.alert_color,t.alert_title,t.alert_message),loadingToggle(e,null)})};